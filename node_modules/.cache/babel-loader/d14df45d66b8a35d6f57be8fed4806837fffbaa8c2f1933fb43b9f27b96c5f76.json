{"ast":null,"code":"import _toConsumableArray from\"C:/Disc D/\\u041F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u0443\\u0432\\u0430\\u043D\\u043D\\u044F 2.0/reactJS/react_varenuk/react-varenuk/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"C:/Disc D/\\u041F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u0443\\u0432\\u0430\\u043D\\u043D\\u044F 2.0/reactJS/react_varenuk/react-varenuk/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _regeneratorRuntime from\"C:/Disc D/\\u041F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u0443\\u0432\\u0430\\u043D\\u043D\\u044F 2.0/reactJS/react_varenuk/react-varenuk/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Disc D/\\u041F\\u0440\\u043E\\u0433\\u0440\\u0430\\u043C\\u0443\\u0432\\u0430\\u043D\\u043D\\u044F 2.0/reactJS/react_varenuk/react-varenuk/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import React from\"react\";import qs from\"qs\";import{useSelector}from\"react-redux\";import{useNavigate}from\"react-router-dom\";import{setCategoryId,setSort,setCurrentPage,setFilters,selectFilter}from\"../redux/slices/filterSlice\";import Categories from\"../components/Categories\";import Sort,{sortList}from\"../components/Sort\";import VarenukBlock from\"../components/VarenukBlock\";import{Pagination}from\"../components/Pagination\";import{Skeleton}from\"../components/VarenukBlock/Skeleton\";import{fetchVarenuks,selectVarenuk}from\"../redux/slices/varenukSlice\";import{useAppDispatch}from\"../redux/store\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var navigate=useNavigate();var dispatch=useAppDispatch();var isSearch=React.useRef(false);var isMounted=React.useRef(false);var _useSelector=useSelector(selectFilter),categoryId=_useSelector.categoryId,sort=_useSelector.sort,currentPage=_useSelector.currentPage,searchValue=_useSelector.searchValue;var _useSelector2=useSelector(selectVarenuk),items=_useSelector2.items,status=_useSelector2.status;var onChangeCategory=React.useCallback(function(idx){dispatch(setCategoryId(idx));},[]);var onChangePage=function onChangePage(page){dispatch(setCurrentPage(page));};var onChangeSort=function onChangeSort(obj){dispatch(setSort(obj));};var getVarenuks=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var order,sortBy,category,search;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:order=sort.sortProperty.includes(\"-\")?\"asc\":\"desc\";sortBy=sort.sortProperty.replace(\"-\",\"\");category=categoryId>0?\"category=\".concat(categoryId):\"\";search=searchValue?\"&search=\".concat(searchValue):\"\";dispatch(fetchVarenuks({order:order,sortBy:sortBy,category:category,search:search,currentPage:String(currentPage)}));case 5:case\"end\":return _context.stop();}},_callee);}));return function getVarenuks(){return _ref.apply(this,arguments);};}();React.useEffect(function(){if(isMounted.current){var queryString=qs.stringify({sortProperty:sort.sortProperty,categoryId:categoryId,currentPage:currentPage});navigate(\"/?\".concat(queryString));}if(!window.location.search){dispatch(fetchVarenuks({}));}getVarenuks();isMounted.current=true;},[categoryId,sort.sortProperty,currentPage]);React.useEffect(function(){if(window.location.search){var params=qs.parse(window.location.search.substring(1));var _sort=sortList.find(function(obj){return obj.sortProperty==params.sortBy;});dispatch(setFilters({searchValue:params.search,categoryId:Number(params.category),currentPage:Number(params.currentPage),sort:_sort||sortList[0]}));isSearch.current=true;}},[]);React.useEffect(function(){window.scrollTo(0,0);if(!isSearch.current){getVarenuks();}isSearch.current=false;},[categoryId,sort.sortProperty,searchValue,currentPage]);var varenuks=items.map(function(obj){return/*#__PURE__*/_jsx(VarenukBlock,_objectSpread({},obj),obj.id);});var skeletons=_toConsumableArray(new Array(8)).map(function(_,i){return/*#__PURE__*/_jsx(Skeleton,{},i);});return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Categories,{value:categoryId,onChangeCategory:onChangeCategory}),/*#__PURE__*/_jsx(Sort,{sort:sort,onChangeSort:onChangeSort})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0456 \\u0432\\u0430\\u0440\\u0435\\u043D\\u0438\\u043A\\u0438\"}),status==\"error\"?/*#__PURE__*/_jsxs(\"div\",{className:\"content__error-info\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0412\\u0438\\u043D\\u0438\\u043A\\u043B\\u0430 \\u043F\\u043E\\u043C\\u0438\\u043B\\u043A\\u0430 \\uD83D\\uDE15\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u041D\\u0430\\u0436\\u0430\\u043B\\u044C \\u043D\\u0435 \\u0432\\u0434\\u0430\\u043B\\u043E\\u0441\\u044F \\u043E\\u0442\\u0440\\u0438\\u043C\\u0430\\u0442\\u0438 \\u0432\\u0430\\u0440\\u0438\\u043D\\u0438\\u043A\\u0438\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u0421\\u043F\\u0440\\u043E\\u0431\\u0443\\u0439\\u0442\\u0435 \\u043F\\u043E\\u0432\\u0442\\u043E\\u0440\\u0438\\u0442\\u0438 \\u043F\\u0456\\u0437\\u043D\\u0456\\u0448\\u0435\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:status==\"loading\"?skeletons:varenuks}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,onChangePage:onChangePage})]});};export default Home;","map":{"version":3,"names":["React","qs","useSelector","useNavigate","setCategoryId","setSort","setCurrentPage","setFilters","selectFilter","Categories","Sort","sortList","VarenukBlock","Pagination","Skeleton","fetchVarenuks","selectVarenuk","useAppDispatch","Home","navigate","dispatch","isSearch","useRef","isMounted","categoryId","sort","currentPage","searchValue","items","status","onChangeCategory","useCallback","idx","onChangePage","page","onChangeSort","obj","getVarenuks","order","sortProperty","includes","sortBy","replace","category","search","String","useEffect","current","queryString","stringify","window","location","params","parse","substring","find","Number","scrollTo","varenuks","map","id","skeletons","Array","_","i"],"sources":["C:/Disc D/Програмування 2.0/reactJS/react_varenuk/react-varenuk/src/pages/Home.tsx"],"sourcesContent":["import React from \"react\";\r\nimport qs from \"qs\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nimport {\r\n  setCategoryId,\r\n  setSort,\r\n  setCurrentPage,\r\n  setFilters,\r\n  selectFilter,\r\n  SortSlice,\r\n} from \"../redux/slices/filterSlice\";\r\n\r\nimport Categories from \"../components/Categories\";\r\nimport Sort, { sortList } from \"../components/Sort\";\r\nimport VarenukBlock from \"../components/VarenukBlock\";\r\nimport { Pagination } from \"../components/Pagination\";\r\nimport { Skeleton } from \"../components/VarenukBlock/Skeleton\";\r\n\r\nimport {\r\n  fetchVarenuks,\r\n  SearchVarenukParams,\r\n  selectVarenuk,\r\n} from \"../redux/slices/varenukSlice\";\r\nimport { useAppDispatch } from \"../redux/store\";\r\n\r\nconst Home: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const dispatch = useAppDispatch();\r\n  const isSearch = React.useRef(false);\r\n  const isMounted = React.useRef(false);\r\n\r\n  const { categoryId, sort, currentPage, searchValue } =\r\n    useSelector(selectFilter);\r\n  const { items, status } = useSelector(selectVarenuk);\r\n\r\n  const onChangeCategory = React.useCallback((idx: number) => {\r\n    dispatch(setCategoryId(idx));\r\n  }, []);\r\n\r\n  const onChangePage = (page: number) => {\r\n    dispatch(setCurrentPage(page));\r\n  };\r\n\r\n  const onChangeSort = (obj: SortSlice) => {\r\n    dispatch(setSort(obj));\r\n  };\r\n\r\n  const getVarenuks = async () => {\r\n    const order = sort.sortProperty.includes(\"-\") ? \"asc\" : \"desc\";\r\n    const sortBy = sort.sortProperty.replace(\"-\", \"\");\r\n    const category = categoryId > 0 ? `category=${categoryId}` : \"\";\r\n    const search = searchValue ? `&search=${searchValue}` : \"\";\r\n\r\n    dispatch(\r\n      fetchVarenuks({\r\n        order,\r\n        sortBy,\r\n        category,\r\n        search,\r\n        currentPage: String(currentPage),\r\n      })\r\n    );\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (isMounted.current) {\r\n      const queryString = qs.stringify({\r\n        sortProperty: sort.sortProperty,\r\n        categoryId,\r\n        currentPage,\r\n      });\r\n\r\n      navigate(`/?${queryString}`);\r\n    }\r\n    if (!window.location.search) {\r\n      dispatch(fetchVarenuks({} as SearchVarenukParams));\r\n    }\r\n    getVarenuks();\r\n    isMounted.current = true;\r\n  }, [categoryId, sort.sortProperty, currentPage]);\r\n\r\n  React.useEffect(() => {\r\n    if (window.location.search) {\r\n      const params = qs.parse(\r\n        window.location.search.substring(1)\r\n      ) as unknown as SearchVarenukParams;\r\n\r\n      const sort = sortList.find((obj) => obj.sortProperty == params.sortBy);\r\n\r\n      dispatch(\r\n        setFilters({\r\n          searchValue: params.search,\r\n          categoryId: Number(params.category),\r\n          currentPage: Number(params.currentPage),\r\n          sort: sort || sortList[0],\r\n        })\r\n      );\r\n      isSearch.current = true;\r\n    }\r\n  }, []);\r\n\r\n  React.useEffect(() => {\r\n    window.scrollTo(0, 0);\r\n\r\n    if (!isSearch.current) {\r\n      getVarenuks();\r\n    }\r\n    isSearch.current = false;\r\n  }, [categoryId, sort.sortProperty, searchValue, currentPage]);\r\n\r\n  const varenuks = items.map((obj: any) => (\r\n    <VarenukBlock key={obj.id} {...obj} />\r\n  ));\r\n  const skeletons = [...new Array(8)].map((_, i) => <Skeleton key={i} />);\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"content__top\">\r\n        <Categories value={categoryId} onChangeCategory={onChangeCategory} />\r\n        <Sort sort={sort} onChangeSort={onChangeSort} />\r\n      </div>\r\n      <h2 className=\"content__title\">Всі вареники</h2>\r\n      {status == \"error\" ? (\r\n        <div className=\"content__error-info\">\r\n          <h2>Виникла помилка 😕</h2>\r\n          <p>Нажаль не вдалося отримати вариники</p>\r\n          <p>Спробуйте повторити пізніше</p>\r\n        </div>\r\n      ) : (\r\n        <div className=\"content__items\">\r\n          {status == \"loading\" ? skeletons : varenuks}\r\n        </div>\r\n      )}\r\n\r\n      <Pagination currentPage={currentPage} onChangePage={onChangePage} />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}